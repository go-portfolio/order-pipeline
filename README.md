# Order Processing Pipeline

## –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

`order-pipeline` ‚Äî —ç—Ç–æ Go-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤ —Å –ø–∞–π–ø–ª–∞–π–Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.  
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É —Å–æ–±—ã—Ç–∏–π–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã.

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ü—Ä–∏—ë–º –∑–∞–∫–∞–∑–æ–≤ —á–µ—Ä–µ–∑ gRPC
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ Kafka
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Redis
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏ —á–µ—Ä–µ–∑ Docker –∏ Delve

---

## üìå –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**
```
Client ‚Üí gRPC API ‚Üí Kafka ‚Üí Worker ‚Üí Redis ‚Üí Client
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

| –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å    | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------------|----------|
| **OrderService (gRPC)** | –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–∫–∞–∑—ã –∏ –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ Kafka |
| **Worker** | –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ Kafka, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∑–∞–∫–∞–∑, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Redis |
| **CacheService (gRPC)** | –û—Ç–¥–∞—ë—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞ –∏–∑ Redis –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ |

---

## üöÄ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑
–ß—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å —Ç—è–∂—ë–ª—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ:

```bash
docker build -f build/base/Dockerfile.build-base -t order-build-base .
```
2. –°–±–æ—Ä–∫–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞
–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è cacheservice:

```bash
docker compose build cacheservice
docker compose up cacheservice
docker compose exec -it cacheservice sh
```
–ó–∞–ø—É—Å–∫ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
/app # /app/cacheservice
```
3. –°–±–æ—Ä–∫–∞ —Å docker-compose.override.yml
```bash
docker compose up -d --build tests
```
–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –ª–æ–≥–æ–≤:
```bash
DOCKER_BUILDKIT=0 docker compose -f docker-compose.yml -f docker-compose.override.yml build --no-cache --progress=plain tests
```
4. –ü—Ä–æ–¥–∞–∫—à–Ω
–í .env —É–∫–∞–∑—ã–≤–∞–µ–º:
```ini
MODE=prod
```
–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ orderreceiver:
```bash
docker compose -f docker-compose.prod.yml up -d orderreceiver --build
```
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
```bash
docker compose -f docker-compose.prod.yml ps
```
## üîç –û—Ç–ª–∞–¥–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
gRPC-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤:
```bash
grpcurl -plaintext 127.0.0.1:50051 list
```
–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
```
grpc.reflection.v1.ServerReflection
grpc.reflection.v1alpha.ServerReflection
order.OrderService
```
## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Delve (dlv)
–ó–∞–ø—É—Å–∫ –≤ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–º —Ä–µ–∂–∏–º–µ:
```bash
docker exec -it tests bash
dlv test ./tests --headless --listen=:40003 --api-version=2 --accept-multiclient --log
```
## üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Å—Ç–µ–∫
`Go` ‚Äî –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã (gRPC, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)

`Kafka` ‚Äî –æ–±–º–µ–Ω —Å–æ–±—ã—Ç–∏—è–º–∏

`Redis` ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

`Docker` / `Docker Compose` ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è

`Delve (dlv)` ‚Äî –æ—Ç–ª–∞–¥–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## üì¶ –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å `Worker` –∏ `CacheService`.

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ `Kafka`, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

`Redis` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –∫—ç—à –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –æ–±—Ä–∞–±–æ—Ç–∫–∏.

`Docker` –∏ `docker-compose` –ø–æ–∑–≤–æ–ª—è—é—Ç –±—ã—Å—Ç—Ä–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–¥–∞–∫—à–Ω–∞.